<!DOCTYPE html>
  <head>
    <title>Challenge Preview #1</title>
  </head>
  <body>
    <iframe src="/challenges/1/index.html" id="preview" height="1024" width="800" frameBorder="0"></iframe>
    <script>
      var iframe = document.getElementById('preview');
      var wsHost = document.location.hostname.split(':')[0] + ':19999';
      var ws = new WebSocket('ws://' + wsHost + '/livereload');
      ws.onopen = function(event) {
        var hello = {
          command: 'hello',
          protocols: ['http://livereload.com/protocols/official-7']
        };
        ws.send(JSON.stringify(hello));
      };

      ws.onmessage = function(event) {
        var data = JSON.parse(event.data) || {};
        if (data.command === 'reload') {
          var src = data.path.split('/').splice(-3).splice(0, 2).join('/') + '/index.html';
          var newSrc = '/' + src;
          if (iframe.getAttribute('src') !== newSrc) {
            if (iframe.parentNode) {
              iframe.parentNode.removeChild(iframe);
              iframe = document.createElement("iframe");
              iframe.setAttribute('id', 'preview');
              iframe.setAttribute('height', '1024');
              iframe.setAttribute('width', '800');
              iframe.setAttribute('frameBorder', '0');
            }

            iframe.setAttribute('src', newSrc);
            document.body.appendChild(iframe);
            document.title = 'Challenge Preview #' + src.split('/')[1];
          }
        }
      };
    </script>
  </body>
</html>
